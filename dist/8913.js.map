{"version":3,"file":"8913.js","mappings":"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","sources":["webpack://@web3os-core/kernel/./node_modules/.pnpm/github.com+web3os-org+openocean-api@1182ec93175afe2bc1bae504bb4b79485811a0c7/node_modules/@web3os/openocean-api/dist/index.mjs","webpack://@web3os-core/kernel/./src/modules/account/index.js"],"sourcesContent":["const $e9036bc7e4b4ba73$var$BaseURL = 'https://open-api.openocean.finance/v1/cross';\nasync function $e9036bc7e4b4ba73$export$433ece0ffb4f36c7(chain = 1) {\n    const result = await fetch(`${$e9036bc7e4b4ba73$var$BaseURL}/tokenList?chainId=${chain}`);\n    const { code: code , data: data  } = await result.json();\n    if (code !== 200) throw new Error(result);\n    return data;\n}\nasync function $e9036bc7e4b4ba73$export$df96cd8d56be0ab1(chain = 1, account, inTokenAddress) {\n    if (!account || !inTokenAddress) throw new Error('Account and inTokenAddress are required');\n    const result = await fetch(`${$e9036bc7e4b4ba73$var$BaseURL}/getBalance?chainId=${chain}&account=${account}&inTokenAddress=${inTokenAddress}`);\n    const { code: code , data: data  } = await result.json();\n    if (code !== 200) throw new Error(result);\n    return data;\n}\n\n\nexport {$e9036bc7e4b4ba73$export$433ece0ffb4f36c7 as tokenList, $e9036bc7e4b4ba73$export$df96cd8d56be0ab1 as getBalance};\n//# sourceMappingURL=index.mjs.map\n","/**\r\n * Web3os Account Manager\r\n * @module @web3os-core/account\r\n * @description Manage your web3 wallet\r\n * @author Jay Mathis <code@mathis.network>\r\n * @license MIT\r\n * @see https://github.com/web3os-org/kernel\r\n */\r\n\r\nimport arg from 'arg'\r\nimport colors from 'ansi-colors'\r\nimport { parse as cliParse } from 'shell-quote'\r\nimport Web3 from 'web3'\r\nimport * as Ocean from '@web3os/openocean-api'\r\n\r\nimport chains from './chains.json'\r\n\r\nexport const name = 'account'\r\nexport const version = '0.1.3'\r\nexport const description = 'Manage your web3 wallet'\r\nexport const help = `\r\n  ${colors.magenta.bold(`NOTE: This tool is being replaced by the ${colors.underline('wallet')} command`)}\r\n\r\n  Usage:\r\n    account                          ${colors.gray('Display your wallet address, or connects if none')}\r\n    account <command>                ${colors.gray('Perform an account action')}\r\n\r\n  Commands:\r\n    connect                          ${colors.gray('Connect to your wallet')}\r\n    chain                            ${colors.gray('Display information about the current chain')}\r\n    chain <id>                       ${colors.gray('Switch to chain id; may be hex, decimal, or name')}\r\n    balance                          ${colors.gray(\"Display the account balance of the chain's native currency\")}\r\n    balance <token>                  ${colors.gray('Displays the account balance of the ERC20 token, eg. USDC')}\r\n    sign <message>                   ${colors.gray('Sign a message using your wallet')}\r\n    send <amount> <address>          ${colors.gray('Send <amount> of native coin to <address>')}\r\n\r\n  Options:\r\n    --help                         Print this help message\r\n    --version                      Print the version information\r\n    --wallet                       {metamask},walletconnect\r\n`\r\n\r\nexport const spec = {\r\n  '--help': Boolean,\r\n  '--version': Boolean\r\n}\r\n\r\nexport let web3\r\nexport let term\r\nexport let signer\r\nexport let provider\r\nexport let tokens\r\nexport const allChains = chains\r\n\r\nprovider = Web3.givenProvider\r\nweb3 = new Web3(provider)\r\n\r\nexport function setPrompt (terminal) {\r\n  terminal = terminal || term || globalThis.Terminal\r\n  const displayAddress = `${colors.gray('0x')}${colors.primary(account.address?.substr(2, 4))}${colors.gray('..')}${colors.primary(account.address?.substr(-4, 4))}`\r\n  terminal.promptFormat = `(${colors.warning(account.chain.chain)})[${colors.info(`0x${account.chainId.toString(16)}`)}]<${displayAddress}>:{cwd}${colors.green('#')} `\r\n}\r\n\r\nexport const account = {\r\n  address: null, _chainId: 1, encryptionPublicKey: null,\r\n\r\n  get chain () {\r\n    return chains?.find(chain => chain.chainId === this._chainId)\r\n  },\r\n\r\n  get chainId () { return this._chainId },\r\n  set chainId (newChainId) {\r\n    this._chainId = Number(newChainId)\r\n    updateTokenList()\r\n    setPrompt()\r\n  }\r\n}\r\n\r\nexport async function updateTokenList () {\r\n  try {\r\n    tokens = await Ocean.tokenList(account.chainId)\r\n  } catch (err) {\r\n    console.error(err)\r\n    throw err\r\n  }\r\n}\r\n\r\nexport async function connect () {\r\n  try {\r\n    const accounts = await web3.eth.getAccounts()\r\n    if (accounts.length === 0) {\r\n      await provider.request({\r\n        method: 'wallet_requestPermissions',\r\n        params: [{ eth_accounts: {} }]\r\n      })\r\n    }\r\n\r\n    account.address = (await web3.eth.getAccounts())[0]\r\n    account.chainId = await web3.eth.getChainId()\r\n\r\n    // account.encryptionPublicKey = await provider.request({\r\n    //   method: 'eth_getEncryptionPublicKey',\r\n    //   params: [account.address]\r\n    // })\r\n  } catch {\r\n    throw new Error(colors.danger('Failed to connect to web3 provider. Do you have https://metamask.io installed and unlocked?'))\r\n  }\r\n\r\n  term.log(`${colors.success('Connected to account:')} ${colors.bold.blue(account.address)}`)\r\n\r\n  // Subscribe to accounts change\r\n  provider.on('accountsChanged', accounts => {\r\n    // console.log('accountsChanged', accounts)\r\n    account.address = accounts[0]\r\n    setPrompt()\r\n  })\r\n\r\n  // Subscribe to chainId change\r\n  provider.on('chainChanged', chainId => {\r\n    // console.log('chainChanged', chainId)\r\n    account.chainId = chainId\r\n  })\r\n\r\n  // Subscribe to provider connection\r\n  provider.on('connect', info => {\r\n    console.log('connect', info)\r\n  })\r\n\r\n  // Subscribe to provider disconnection\r\n  provider.on('disconnect', error => {\r\n    console.error('disconnect', error)\r\n  })\r\n\r\n  return account.address\r\n}\r\n\r\nexport async function switchChain (args) {\r\n  if (!args._[1]) return term.log(account.chain)\r\n  let newChain = args._[1]\r\n\r\n  if (!newChain) return term.log(JSON.stringify(account.chain, null, 2))\r\n\r\n  let findBy\r\n  if (!isNaN(parseInt(newChain))) findBy = parseInt(newChain)\r\n  else if (typeof newChain === 'string') {\r\n    if (newChain.substr(0, 2) === '0x') findBy = Number(newChain)\r\n    else {\r\n      switch (newChain) {\r\n        case 'ethereum':\r\n          newChain = 'eth'\r\n          break\r\n      }\r\n\r\n      const chain = chains.find(c => {\r\n        return (\r\n          c.chain.toLowerCase() === newChain.toLowerCase() ||\r\n          c.network.toLowerCase() === newChain.toLowerCase() ||\r\n          c.name.toLowerCase() === newChain.toLowerCase() ||\r\n          c.infoURL.toLowerCase() === newChain.toLowerCase() ||\r\n          c.shortName.toLowerCase() === newChain.toLowerCase() ||\r\n          c.nativeCurrency.name.toLowerCase() === newChain.toLowerCase()\r\n        )\r\n      })\r\n\r\n      if (!chain) return term.log(colors.danger(`Cannot find chain ${newChain}`))\r\n      findBy = chain.chainId\r\n    }\r\n  }\r\n\r\n  const chainInfo = chains?.find(chain => chain.chainId === findBy)\r\n  if (!chainInfo) return term.log(colors.danger(`Cannot find chain ${newChain}`))\r\n\r\n  try {\r\n    term.log(colors.warning(`Trying to switch to the ${chainInfo.name} network...`))\r\n    await provider.request({\r\n      method: 'wallet_switchEthereumChain',\r\n      params: [{ chainId: `0x${chainInfo.chainId.toString(16)}` }]\r\n    })\r\n\r\n    account.chainId = chainInfo.chainId\r\n  } catch (err) {\r\n    if (err.code === 4902) {\r\n      term.log(colors.warning(\"The network wasn't known by the wallet, trying to add it now..\"))\r\n      await provider.request({\r\n        method: 'wallet_addEthereumChain',\r\n        params: [{\r\n          chainId: `0x${chainInfo.chainId.toString(16)}`,\r\n          chainName: chainInfo.name,\r\n          nativeCurrency: chainInfo.nativeCurrency,\r\n          rpcUrls: chainInfo.rpc\r\n        }]\r\n      })\r\n    } else {\r\n      console.error(err)\r\n    }\r\n\r\n    console.error(err)\r\n    term.log(colors.danger(err.message))\r\n  }\r\n}\r\n\r\nexport async function getBalance (symbol) {\r\n  if (!account.address) throw new Error('Not connected to wallet')\r\n  let balance = 0\r\n\r\n  if (!symbol) {\r\n    balance = web3.utils.fromWei(await web3.eth.getBalance(account.address)) + ' ' + account.chain.nativeCurrency.symbol\r\n  } else {\r\n    const token = tokens\r\n      ? symbol.substr(0, 2) === '0x'\r\n          ? tokens?.find(token => token.address === symbol)\r\n          : tokens?.find(token => token.symbol === symbol)\r\n      : null\r\n\r\n    if (!token) throw new Error(colors.danger('Unknown token on this network'))\r\n\r\n    const data = await Ocean.getBalance(account.chainId, account.address, token.address)\r\n    balance = data[0].balance + ' ' + data[0].symbol\r\n  }\r\n\r\n  return balance\r\n}\r\n\r\nexport async function sign (message) {\r\n  message = message.replace(/\\\\n/g, '\\n')\r\n  return await web3.eth.personal.sign(message, account.address)\r\n}\r\n\r\nexport async function send (args) {\r\n  return await web3.eth.sendTransaction({\r\n    from: account.address,\r\n    to: args._[2],\r\n    value: Web3.utils.toWei(args._[1])\r\n  })\r\n}\r\n\r\nasync function displayOrConnect () {\r\n  if (!account.address) return await connect()\r\n  term.log(account.address)\r\n}\r\n\r\nexport async function run (terminal, context) {\r\n  term = terminal\r\n  const args = arg(spec, { argv: cliParse(context) })\r\n  const cmd = args._?.[0]\r\n\r\n  if (args['--version']) return term.log(version)\r\n  if (args['--help']) return term.log(help)\r\n\r\n  switch (cmd) {\r\n    case 'connect':\r\n      return connect(args)\r\n    case 'chain':\r\n      return switchChain(args)\r\n    case 'balance':\r\n      return term.log(await getBalance(args?._[1]))\r\n    case 'sign':\r\n      return term.log(await sign(args?._[1]))\r\n    case 'send':\r\n      return term.log(await send(args))\r\n    case undefined:\r\n      return displayOrConnect(args)\r\n    default:\r\n      throw new Error('account: invalid command')\r\n  }\r\n}\r\n"],"names":["$e9036bc7e4b4ba73$var$BaseURL","async","$e9036bc7e4b4ba73$export$433ece0ffb4f36c7","chain","result","fetch","code","data","json","Error","$e9036bc7e4b4ba73$export$df96cd8d56be0ab1","account","inTokenAddress","web3","term","provider","tokens","name","version","description","help","colors","spec","Boolean","allChains","chains","setPrompt","terminal","globalThis","Terminal","displayAddress","address","substr","promptFormat","chainId","toString","Web3","_chainId","encryptionPublicKey","this","newChainId","Number","updateTokenList","Ocean","console","error","connect","eth","getAccounts","length","request","method","params","eth_accounts","getChainId","log","on","accounts","info","switchChain","args","_","newChain","JSON","stringify","isNaN","parseInt","findBy","find","c","toLowerCase","network","infoURL","shortName","nativeCurrency","chainInfo","chainName","rpcUrls","rpc","message","getBalance","symbol","balance","utils","fromWei","token","sign","replace","personal","send","sendTransaction","from","to","value","displayOrConnect","run","context","arg","argv","cliParse","cmd","undefined"],"sourceRoot":""}