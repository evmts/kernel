{"version":3,"file":"3031.js","mappings":"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","sources":["file:////home/j/code/web3os/@web3os-core/kernel/src/modules/edit/index.js","file:////home/j/code/web3os/@web3os-core/kernel/src/modules/edit/edit.css","webpack://@web3os-core/kernel/./src/modules/edit/edit.css?0776"],"sourcesContent":["import colors from 'ansi-colors'\r\nimport CodeMirror from 'codemirror'\r\n\r\nimport 'codemirror/mode/javascript/javascript'\r\nimport 'codemirror/mode/yaml/yaml'\r\n\r\nimport 'codemirror/addon/display/fullscreen'\r\nimport 'codemirror/addon/selection/active-line'\r\nimport 'codemirror/addon/dialog/dialog'\r\nimport 'codemirror/addon/search/searchcursor'\r\nimport 'codemirror/addon/search/search'\r\nimport 'codemirror/addon/scroll/annotatescrollbar'\r\nimport 'codemirror/addon/search/matchesonscrollbar'\r\nimport 'codemirror/addon/search/jump-to-line'\r\n\r\nimport './edit.css'\r\nimport 'codemirror/lib/codemirror.css'\r\nimport 'codemirror/theme/the-matrix.css'\r\nimport 'codemirror/addon/display/fullscreen.css'\r\nimport 'codemirror/addon/dialog/dialog.css'\r\nimport 'codemirror/addon/search/matchesonscrollbar.css'\r\n\r\nexport const name = 'edit'\r\nexport const description = 'GUI File Editor'\r\nexport const help = `\r\n  Usage:\r\n    edit <filename>\r\n`\r\n\r\nlet kernel = globalThis.Kernel\r\n\r\nasync function executeFile ({ filename, extension }) {\r\n  try {\r\n    switch (extension) {\r\n      case '.js':\r\n        await kernel.execute(`eval ${filename}`)\r\n        break\r\n      case '.sh':\r\n        await kernel.executeScript(filename)\r\n        break\r\n    }\r\n\r\n    return true\r\n  } catch (err) {\r\n    console.error(err)\r\n    kernel.dialog({ title: 'Error executing file', text: err.message })\r\n    return false\r\n  }\r\n}\r\n\r\nasync function saveFile ({ filename, mirror }) {\r\n  try {\r\n    kernel.fs.writeFileSync(filename, mirror.getValue())\r\n    return true\r\n  } catch (err) {\r\n    console.error(err)\r\n    kernel.dialog({ title: 'Error saving file', text: err.message })\r\n    return false\r\n  }\r\n}\r\n\r\nexport async function run (terminal, filename) {\r\n  kernel = terminal.kernel\r\n\r\n  if (filename === '') filename = `/tmp/editor-${Math.random().toString(36).slice(2)}`\r\n  if (!filename) return terminal.log(colors.danger('Invalid filename') + '\\n' + help)\r\n  filename = kernel.utils.path.resolve(terminal.cwd, filename)\r\n  const fileParts = kernel.utils.path.parse(filename)\r\n  const extension = fileParts.ext\r\n\r\n  let mode, executable\r\n\r\n  switch (extension) {\r\n    case '.js':\r\n      mode = 'javascript'\r\n      executable = true\r\n      break\r\n    case '.json':\r\n      mode = { name: 'javascript', mode: 'json' }\r\n      break\r\n    case '.yml':\r\n      mode = 'yaml'\r\n      break\r\n    case '.sh':\r\n      executable = true\r\n      break\r\n    default:\r\n      mode = null\r\n  }\r\n\r\n  const content = document.createElement('div')\r\n  const textarea = document.createElement('textarea')\r\n\r\n  if (!kernel.fs.existsSync(filename)) kernel.fs.writeFileSync(filename, '')\r\n  const value = kernel.fs.readFileSync(filename, 'utf8')\r\n  textarea.value = value\r\n  content.style.height = '100%'\r\n\r\n  content.appendChild(textarea)\r\n\r\n  const appWindow = kernel.windows.create({\r\n    title: `Edit: ${filename}`,\r\n    mount: content,\r\n    height: '75%',\r\n    width: '100%'\r\n  })\r\n\r\n  const mirror = CodeMirror.fromTextArea(textarea, {\r\n    mode,\r\n    theme: 'the-matrix',\r\n    lineNumbers: true,\r\n    styleActiveLine: true,\r\n    viewportMargin: Infinity,\r\n    extraKeys: {\r\n      'Ctrl-S': () => saveFile({ filename, mirror }),\r\n      'Ctrl-R': () => executeFile({ filename, extension }),\r\n      'Ctrl-Q': () => { appWindow.window.close(); terminal.focus() }\r\n    }\r\n  })\r\n\r\n  appWindow.window.onresize = (width, height) => {\r\n    mirror.refresh()\r\n    mirror.focus()\r\n  }\r\n\r\n  const buttons = [\r\n    {\r\n      component: '<mwc-button slot=\"primaryAction\" icon=\"save\" raised>Save</mwc-button>',\r\n      action: () => saveFile({ mirror, filename })\r\n    },\r\n\r\n    {\r\n      component: '<mwc-button icon=\"help_outline\">Help</mwc-button>',\r\n      action: () => {\r\n        kernel.dialog({\r\n          title: 'Editor Help',\r\n          html: `\r\n            <p>\r\n              <strong>Keyboard Shortcuts:</strong>\r\n              <ul style='text-align:left'>\r\n                <li>Ctrl+Q: Quit editor</li>\r\n                <li>Ctrl+S: Save file</li>\r\n                ${executable ? '<li>Ctrl+R: Save & Run</li>' : ''}\r\n                <li>Ctrl+F: Search</li>\r\n                <li>Alt+G: Jump to line number</li>\r\n              </ul>\r\n            </p>\r\n          `\r\n        })\r\n      }\r\n    }\r\n  ]\r\n\r\n  if (executable) {\r\n    buttons.unshift({\r\n      component: '<mwc-button icon=\"play_arrow\" raised>Save &amp; Run</mwc-button>',\r\n      action: async () => {\r\n        await saveFile({ filename, mirror })\r\n        await executeFile({ filename, extension })\r\n      }\r\n    })\r\n  }\r\n\r\n  const buttonWrapper = document.createElement('div')\r\n  buttonWrapper.classList.add('app-actions')\r\n  buttonWrapper.style.display = 'flex'\r\n  buttonWrapper.style.justifyContent = 'flex-end'\r\n  buttonWrapper.style.gap = '0.5rem'\r\n  buttonWrapper.style.marginTop = '0.25rem'\r\n  buttonWrapper.style.marginRight = '0.5rem'\r\n\r\n  for (const button of buttons.reverse()) {\r\n    const btn = document.createElement('div')\r\n    btn.insertAdjacentHTML('beforeend', button.component)\r\n    btn.firstChild.style = button.style || ''\r\n    btn.firstChild.addEventListener('click', button.action)\r\n    buttonWrapper.appendChild(btn)\r\n  }\r\n\r\n  content.appendChild(buttonWrapper)\r\n  setTimeout(() => {\r\n    mirror.refresh()\r\n    mirror.focus()\r\n  }, 200)\r\n}\r\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/.pnpm/css-loader@6.7.1_webpack@5.73.0/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/.pnpm/css-loader@6.7.1_webpack@5.73.0/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".CodeMirror {\\r\\n  height: 90% !important;\\r\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/modules/edit/edit.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,sBAAsB;AACxB\",\"sourcesContent\":[\".CodeMirror {\\r\\n  height: 90% !important;\\r\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../../node_modules/.pnpm/style-loader@3.3.1_webpack@5.73.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../node_modules/.pnpm/style-loader@3.3.1_webpack@5.73.0/node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../node_modules/.pnpm/style-loader@3.3.1_webpack@5.73.0/node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../node_modules/.pnpm/style-loader@3.3.1_webpack@5.73.0/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../node_modules/.pnpm/style-loader@3.3.1_webpack@5.73.0/node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../node_modules/.pnpm/style-loader@3.3.1_webpack@5.73.0/node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../node_modules/.pnpm/css-loader@6.7.1_webpack@5.73.0/node_modules/css-loader/dist/cjs.js!./edit.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../node_modules/.pnpm/css-loader@6.7.1_webpack@5.73.0/node_modules/css-loader/dist/cjs.js!./edit.css\";\n       export default content && content.locals ? content.locals : undefined;\n"],"names":["i","name","description","help","kernel","globalThis","Kernel","executeFile","filename","extension","execute","executeScript","console","error","dialog","title","text","message","saveFile","mirror","fs","writeFileSync","getValue","run","terminal","Math","random","toString","slice","log","colors","utils","path","resolve","cwd","fileParts","parse","ext","mode","executable","content","document","createElement","textarea","existsSync","value","readFileSync","style","height","appendChild","appWindow","windows","create","mount","width","CodeMirror","theme","lineNumbers","styleActiveLine","viewportMargin","Infinity","extraKeys","window","close","focus","onresize","refresh","buttons","component","action","html","unshift","buttonWrapper","classList","add","display","justifyContent","gap","marginTop","marginRight","reverse","button","btn","insertAdjacentHTML","firstChild","addEventListener","setTimeout","___CSS_LOADER_EXPORT___","push","module","id","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","undefined"],"sourceRoot":""}