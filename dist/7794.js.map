{"version":3,"file":"7794.js","mappings":"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","sources":["webpack://@web3os-core/kernel/./node_modules/.pnpm/arg@5.0.2/node_modules/arg/index.js","webpack://@web3os-core/kernel/./src/modules/3pm/index.js","webpack://@web3os-core/kernel/./node_modules/.pnpm/shell-quote@1.7.3/node_modules/shell-quote/index.js"],"sourcesContent":["const flagSymbol = Symbol('arg flag');\n\nclass ArgError extends Error {\n\tconstructor(msg, code) {\n\t\tsuper(msg);\n\t\tthis.name = 'ArgError';\n\t\tthis.code = code;\n\n\t\tObject.setPrototypeOf(this, ArgError.prototype);\n\t}\n}\n\nfunction arg(\n\topts,\n\t{\n\t\targv = process.argv.slice(2),\n\t\tpermissive = false,\n\t\tstopAtPositional = false\n\t} = {}\n) {\n\tif (!opts) {\n\t\tthrow new ArgError(\n\t\t\t'argument specification object is required',\n\t\t\t'ARG_CONFIG_NO_SPEC'\n\t\t);\n\t}\n\n\tconst result = { _: [] };\n\n\tconst aliases = {};\n\tconst handlers = {};\n\n\tfor (const key of Object.keys(opts)) {\n\t\tif (!key) {\n\t\t\tthrow new ArgError(\n\t\t\t\t'argument key cannot be an empty string',\n\t\t\t\t'ARG_CONFIG_EMPTY_KEY'\n\t\t\t);\n\t\t}\n\n\t\tif (key[0] !== '-') {\n\t\t\tthrow new ArgError(\n\t\t\t\t`argument key must start with '-' but found: '${key}'`,\n\t\t\t\t'ARG_CONFIG_NONOPT_KEY'\n\t\t\t);\n\t\t}\n\n\t\tif (key.length === 1) {\n\t\t\tthrow new ArgError(\n\t\t\t\t`argument key must have a name; singular '-' keys are not allowed: ${key}`,\n\t\t\t\t'ARG_CONFIG_NONAME_KEY'\n\t\t\t);\n\t\t}\n\n\t\tif (typeof opts[key] === 'string') {\n\t\t\taliases[key] = opts[key];\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet type = opts[key];\n\t\tlet isFlag = false;\n\n\t\tif (\n\t\t\tArray.isArray(type) &&\n\t\t\ttype.length === 1 &&\n\t\t\ttypeof type[0] === 'function'\n\t\t) {\n\t\t\tconst [fn] = type;\n\t\t\ttype = (value, name, prev = []) => {\n\t\t\t\tprev.push(fn(value, name, prev[prev.length - 1]));\n\t\t\t\treturn prev;\n\t\t\t};\n\t\t\tisFlag = fn === Boolean || fn[flagSymbol] === true;\n\t\t} else if (typeof type === 'function') {\n\t\t\tisFlag = type === Boolean || type[flagSymbol] === true;\n\t\t} else {\n\t\t\tthrow new ArgError(\n\t\t\t\t`type missing or not a function or valid array type: ${key}`,\n\t\t\t\t'ARG_CONFIG_VAD_TYPE'\n\t\t\t);\n\t\t}\n\n\t\tif (key[1] !== '-' && key.length > 2) {\n\t\t\tthrow new ArgError(\n\t\t\t\t`short argument keys (with a single hyphen) must have only one character: ${key}`,\n\t\t\t\t'ARG_CONFIG_SHORTOPT_TOOLONG'\n\t\t\t);\n\t\t}\n\n\t\thandlers[key] = [type, isFlag];\n\t}\n\n\tfor (let i = 0, len = argv.length; i < len; i++) {\n\t\tconst wholeArg = argv[i];\n\n\t\tif (stopAtPositional && result._.length > 0) {\n\t\t\tresult._ = result._.concat(argv.slice(i));\n\t\t\tbreak;\n\t\t}\n\n\t\tif (wholeArg === '--') {\n\t\t\tresult._ = result._.concat(argv.slice(i + 1));\n\t\t\tbreak;\n\t\t}\n\n\t\tif (wholeArg.length > 1 && wholeArg[0] === '-') {\n\t\t\t/* eslint-disable operator-linebreak */\n\t\t\tconst separatedArguments =\n\t\t\t\twholeArg[1] === '-' || wholeArg.length === 2\n\t\t\t\t\t? [wholeArg]\n\t\t\t\t\t: wholeArg\n\t\t\t\t\t\t\t.slice(1)\n\t\t\t\t\t\t\t.split('')\n\t\t\t\t\t\t\t.map((a) => `-${a}`);\n\t\t\t/* eslint-enable operator-linebreak */\n\n\t\t\tfor (let j = 0; j < separatedArguments.length; j++) {\n\t\t\t\tconst arg = separatedArguments[j];\n\t\t\t\tconst [originalArgName, argStr] =\n\t\t\t\t\targ[1] === '-' ? arg.split(/=(.*)/, 2) : [arg, undefined];\n\n\t\t\t\tlet argName = originalArgName;\n\t\t\t\twhile (argName in aliases) {\n\t\t\t\t\targName = aliases[argName];\n\t\t\t\t}\n\n\t\t\t\tif (!(argName in handlers)) {\n\t\t\t\t\tif (permissive) {\n\t\t\t\t\t\tresult._.push(arg);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new ArgError(\n\t\t\t\t\t\t\t`unknown or unexpected option: ${originalArgName}`,\n\t\t\t\t\t\t\t'ARG_UNKNOWN_OPTION'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst [type, isFlag] = handlers[argName];\n\n\t\t\t\tif (!isFlag && j + 1 < separatedArguments.length) {\n\t\t\t\t\tthrow new ArgError(\n\t\t\t\t\t\t`option requires argument (but was followed by another short argument): ${originalArgName}`,\n\t\t\t\t\t\t'ARG_MISSING_REQUIRED_SHORTARG'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (isFlag) {\n\t\t\t\t\tresult[argName] = type(true, argName, result[argName]);\n\t\t\t\t} else if (argStr === undefined) {\n\t\t\t\t\tif (\n\t\t\t\t\t\targv.length < i + 2 ||\n\t\t\t\t\t\t(argv[i + 1].length > 1 &&\n\t\t\t\t\t\t\targv[i + 1][0] === '-' &&\n\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\targv[i + 1].match(/^-?\\d*(\\.(?=\\d))?\\d*$/) &&\n\t\t\t\t\t\t\t\t(type === Number ||\n\t\t\t\t\t\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\t\t\t\t\t\t(typeof BigInt !== 'undefined' && type === BigInt))\n\t\t\t\t\t\t\t))\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst extended =\n\t\t\t\t\t\t\toriginalArgName === argName ? '' : ` (alias for ${argName})`;\n\t\t\t\t\t\tthrow new ArgError(\n\t\t\t\t\t\t\t`option requires argument: ${originalArgName}${extended}`,\n\t\t\t\t\t\t\t'ARG_MISSING_REQUIRED_LONGARG'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tresult[argName] = type(argv[i + 1], argName, result[argName]);\n\t\t\t\t\t++i;\n\t\t\t\t} else {\n\t\t\t\t\tresult[argName] = type(argStr, argName, result[argName]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tresult._.push(wholeArg);\n\t\t}\n\t}\n\n\treturn result;\n}\n\narg.flag = (fn) => {\n\tfn[flagSymbol] = true;\n\treturn fn;\n};\n\n// Utility types\narg.COUNT = arg.flag((v, name, existingCount) => (existingCount || 0) + 1);\n\n// Expose error class\narg.ArgError = ArgError;\n\nmodule.exports = arg;\n","/**\r\n * Web3os Package Manager\r\n * @module @web3os-core/3pm\r\n * @description Manage installed packages\r\n * @author Jay Mathis <code@mathis.network>\r\n * @license MIT\r\n * @see https://github.com/web3os-org/kernel\r\n */\r\n\r\n/* global fetch, localStorage */\r\n/* eslint-disable no-new-func */\r\n\r\nimport arg from 'arg'\r\nimport colors from 'ansi-colors'\r\nimport { parse as cliParse } from 'shell-quote'\r\n\r\nexport const DefaultPackageRegistry = 'https://unpkg.com'\r\n\r\nexport const name = '3pm'\r\nexport const version = '0.1.0'\r\nexport const description = 'Web3os Package Manager'\r\nexport const help = `\r\n  ${colors.blue('3pm')}: ${colors.green('The web3os package manager')}\r\n\r\n  Usage:\r\n    3pm <command> <args> [options]\r\n\r\n  Commands:\r\n    install <name>         Install (or update) package named <name> from the registry\r\n    install <url>          Install (or update) package located at <url>\r\n    ls                     List installed packages\r\n    uninstall <name>       Uninstall package\r\n\r\n  Options:\r\n    --help                 Show this help message\r\n    --main                 Override a package's main entrypoint\r\n    --registry             Package registry {https://unpkg.com}\r\n    --system               Install the package as a SystemJS module\r\n    --umd                  Install the package as a UMD module\r\n    --version              Show version information\r\n`\r\n\r\nconst spec = {\r\n  '--help': Boolean,\r\n  '--main': String,\r\n  '--registry': String,\r\n  '--system': Boolean,\r\n  '--umd': Boolean,\r\n  '--version': Boolean,\r\n\r\n  '-h': '--help',\r\n  '-v': '--version'\r\n}\r\n\r\nlet kernel = globalThis.Kernel\r\nlet terminal = globalThis.Terminal\r\n\r\n/**\r\n * ModInfo Object\r\n * @typedef ModInfo\r\n * @property {string} name - Module name\r\n * @property {string} description - Module description\r\n * @property {string} help - Module help information\r\n * @property {string} url - Module URL\r\n * @property {string} pkgJson - Module package.json\r\n * @property {string} pkgJson.web3osData - Data specific to web3os\r\n */\r\n\r\n/**\r\n * Install a package\r\n * @async\r\n * @param {!string} url - The package URL (or just package name to use default registry)\r\n * @param {Object=} args - The arguments for the installation\r\n * @param {boolean=} [args.warn=true] - Show the installation warning if the user has never seen it\r\n * @returns {Promise<(boolean|ModInfo)>} ModInfo or false on error\r\n */\r\nexport async function install (url, args = { warn: true }) {\r\n  const warned = localStorage.getItem('web3os_3pm_install_warning_hidden')\r\n  if (!warned && args.warn) {\r\n    localStorage.setItem('web3os_3pm_install_warning_hidden', true)\r\n    terminal.log(`\\n${colors.bgRed.white('WARNING')}: Do not install any packages unless you trust them completely.`)\r\n    terminal.log(colors.bold(`All apps run in an inherently insecure context. ${colors.danger('This will be your last warning!')}`))\r\n    terminal.log(colors.underline('Repeat the command to continue with the installation\\n'))\r\n    return false\r\n  }\r\n\r\n  if (typeof url === 'object') url = url.url || url.pattern\r\n  if (!url) throw new Error('Invalid package name or URL')\r\n\r\n  if (!/^(http|ftp).*\\:/i.test(url)) url = `${args['--registry'] || DefaultPackageRegistry}/${url}`\r\n  const pkgJson = await (await fetch(`${url}/package.json?t=${Math.random().toString(36)}`, { cache: 'no-store' })).json()\r\n  const name = pkgJson.name\r\n  const pkgName = name.split('/')\r\n  const pkgBrowser = pkgJson.browser ? (typeof pkgJson.browser === 'string' ? pkgJson.browser : Object.values(pkgJson.browser)[0]) : null\r\n  const pkgModule = pkgJson.module ? (typeof pkgJson.module === 'string' ? pkgJson.module : Object.values(pkgJson.module)[0]) : null\r\n  const main = args['--main'] || pkgBrowser || pkgModule || pkgJson.main || 'index.js'\r\n  const mainUrl = `${url}/${main}`\r\n\r\n  let type = 'es'\r\n  if (args['--umd']) type = 'umd'\r\n  if (args['--system']) type = 'system'\r\n\r\n  if (kernel.modules[name]) await uninstall(name)\r\n\r\n  let mod\r\n  try {\r\n    switch (type) {\r\n      case 'umd':\r\n        mod = await kernel.importUMDModule(mainUrl)\r\n        break\r\n      case 'systemjs':\r\n        mod = await globalThis.System.import(mainUrl)\r\n        break\r\n      default:\r\n        mod = await import(/* webpackIgnore: true */ mainUrl)\r\n    }\r\n  } catch (err) {\r\n    console.error('IMPORT ERROR:', err, { name, type, main, mod, pkgJson })\r\n  }\r\n\r\n  if (!mod) throw new Error('Failed to import module')\r\n\r\n  if (pkgName.length > 1) {\r\n    if (!kernel.fs.existsSync(`/var/packages/${pkgName[0]}`)) kernel.fs.mkdirSync(`/var/packages/${pkgName[0]}`)\r\n    if (!kernel.fs.existsSync(`/var/packages/${pkgName[0]}/${pkgName[1]}@${pkgJson.version}`)) kernel.fs.mkdirSync(`/var/packages/${pkgName[0]}/${pkgName[1]}@${pkgJson.version}`)\r\n  } else {\r\n    if (!kernel.fs.existsSync(`/var/packages/${pkgName[0]}@${pkgJson.version}`)) kernel.fs.mkdirSync(`/var/packages/${pkgName[0]}@${pkgJson.version}`)\r\n  }\r\n\r\n  const pkgFolder = pkgName.length > 1 ? `/var/packages/${pkgName[0]}/${pkgName[1]}@${pkgJson.version}` : `/var/packages/${pkgName[0]}@${pkgJson.version}`\r\n  pkgJson.web3osData = { pkgFolder, url, main, type }\r\n  kernel.fs.writeFileSync(`${pkgFolder}/package.json`, JSON.stringify(pkgJson, null, 2), 'utf8')\r\n\r\n  const packages = JSON.parse(kernel.fs.readFileSync('/config/packages', 'utf8'))\r\n  const index = packages.indexOf(url)\r\n  if (index > -1) packages.splice(index, 1)\r\n  packages.push(`${pkgJson.name}@${pkgJson.version}`)\r\n  kernel.fs.writeFileSync('/config/packages', JSON.stringify(packages, null, 2))\r\n\r\n  const description = pkgJson.description || mod.description\r\n  const help = pkgJson.help || mod?.help\r\n  const modInfo = { description, help, name, url, pkgJson }\r\n  await kernel.loadModule(mod, modInfo)\r\n  await mod.web3osInstall?.(modInfo)\r\n\r\n  kernel.execute(`snackbar Installed ${modInfo.name}@${pkgJson.version}`)\r\n  return modInfo\r\n}\r\n\r\n/**\r\n * Uninstall a package\r\n * @async\r\n * @param {!string} name - The name of the package to uninstall\r\n * @returns {boolean} true if the package was uninstalled\r\n */\r\nexport async function uninstall (name) {\r\n  const packages = JSON.parse(kernel.fs.readFileSync('/config/packages', 'utf8'))\r\n  const pkg = packages.find(p => (new RegExp(`^${name}@`)).test(p))\r\n  if (!pkg) throw new Error('Package not found')\r\n  const pkgJson = JSON.parse(kernel.fs.readFileSync(`/var/packages/${pkg}/package.json`))\r\n  const newPackages = packages.filter(p => p !== `${pkgJson.name}@${pkgJson.version}`)\r\n  kernel.fs.writeFileSync('/config/packages', JSON.stringify(newPackages, null, 2))\r\n  if (kernel.fs.existsSync(`/bin/${pkgJson.name}`)) kernel.fs.unlinkSync(`/bin/${pkgJson.name}`)\r\n  // TODO: Delete package folder\r\n  delete kernel.modules[pkgJson.name]\r\n  return true\r\n}\r\n\r\n/**\r\n * Run the 3pm CLI\r\n * @async\r\n * @param {Web3osTerminal} term - The terminal to attach to\r\n * @param {string} context - The arguments string to parse\r\n * @returns {any} result of the command\r\n */\r\nexport async function run (term, context) {\r\n  terminal = term\r\n  kernel = term.kernel\r\n\r\n  const args = arg(spec, { argv: cliParse(context) })\r\n  const cmd = args._?.[0]\r\n\r\n  if (args['--help']) return term.log(help)\r\n  if (args['--version']) return term.log(version)\r\n\r\n  switch (cmd) {\r\n    case 'install':\r\n      return await install(args._?.slice(1)[0], args)\r\n    case 'ls':\r\n      return await kernel.execute('cat /config/packages')\r\n    case 'uninstall':\r\n      return await uninstall(args._?.slice(1)[0], args)\r\n    default:\r\n      return term.log(help)\r\n  }\r\n}\r\n","exports.quote = function (xs) {\n    return xs.map(function (s) {\n        if (s && typeof s === 'object') {\n            return s.op.replace(/(.)/g, '\\\\$1');\n        }\n        else if (/[\"\\s]/.test(s) && !/'/.test(s)) {\n            return \"'\" + s.replace(/(['\\\\])/g, '\\\\$1') + \"'\";\n        }\n        else if (/[\"'\\s]/.test(s)) {\n            return '\"' + s.replace(/([\"\\\\$`!])/g, '\\\\$1') + '\"';\n        }\n        else {\n            return String(s).replace(/([A-Za-z]:)?([#!\"$&'()*,:;<=>?@\\[\\\\\\]^`{|}])/g, '$1\\\\$2');\n        }\n    }).join(' ');\n};\n\n// '<(' is process substitution operator and\n// can be parsed the same as control operator\nvar CONTROL = '(?:' + [\n    '\\\\|\\\\|', '\\\\&\\\\&', ';;', '\\\\|\\\\&', '\\\\<\\\\(', '>>', '>\\\\&', '[&;()|<>]'\n].join('|') + ')';\nvar META = '|&;()<> \\\\t';\nvar BAREWORD = '(\\\\\\\\[\\'\"' + META + ']|[^\\\\s\\'\"' + META + '])+';\nvar SINGLE_QUOTE = '\"((\\\\\\\\\"|[^\"])*?)\"';\nvar DOUBLE_QUOTE = '\\'((\\\\\\\\\\'|[^\\'])*?)\\'';\n\nvar TOKEN = '';\nfor (var i = 0; i < 4; i++) {\n    TOKEN += (Math.pow(16,8)*Math.random()).toString(16);\n}\n\nexports.parse = function (s, env, opts) {\n    var mapped = parse(s, env, opts);\n    if (typeof env !== 'function') return mapped;\n    return mapped.reduce(function (acc, s) {\n        if (typeof s === 'object') return acc.concat(s);\n        var xs = s.split(RegExp('(' + TOKEN + '.*?' + TOKEN + ')', 'g'));\n        if (xs.length === 1) return acc.concat(xs[0]);\n        return acc.concat(xs.filter(Boolean).map(function (x) {\n            if (RegExp('^' + TOKEN).test(x)) {\n                return JSON.parse(x.split(TOKEN)[1]);\n            }\n            else return x;\n        }));\n    }, []);\n};\n\nfunction parse (s, env, opts) {\n    var chunker = new RegExp([\n        '(' + CONTROL + ')', // control chars\n        '(' + BAREWORD + '|' + SINGLE_QUOTE + '|' + DOUBLE_QUOTE + ')*'\n    ].join('|'), 'g');\n    var match = s.match(chunker).filter(Boolean);\n    var commented = false;\n\n    if (!match) return [];\n    if (!env) env = {};\n    if (!opts) opts = {};\n    return match.map(function (s, j) {\n        if (commented) {\n            return;\n        }\n        if (RegExp('^' + CONTROL + '$').test(s)) {\n            return { op: s };\n        }\n\n        // Hand-written scanner/parser for Bash quoting rules:\n        //\n        //  1. inside single quotes, all characters are printed literally.\n        //  2. inside double quotes, all characters are printed literally\n        //     except variables prefixed by '$' and backslashes followed by\n        //     either a double quote or another backslash.\n        //  3. outside of any quotes, backslashes are treated as escape\n        //     characters and not printed (unless they are themselves escaped)\n        //  4. quote context can switch mid-token if there is no whitespace\n        //     between the two quote contexts (e.g. all'one'\"token\" parses as\n        //     \"allonetoken\")\n        var SQ = \"'\";\n        var DQ = '\"';\n        var DS = '$';\n        var BS = opts.escape || '\\\\';\n        var quote = false;\n        var esc = false;\n        var out = '';\n        var isGlob = false;\n\n        for (var i = 0, len = s.length; i < len; i++) {\n            var c = s.charAt(i);\n            isGlob = isGlob || (!quote && (c === '*' || c === '?'));\n            if (esc) {\n                out += c;\n                esc = false;\n            }\n            else if (quote) {\n                if (c === quote) {\n                    quote = false;\n                }\n                else if (quote == SQ) {\n                    out += c;\n                }\n                else { // Double quote\n                    if (c === BS) {\n                        i += 1;\n                        c = s.charAt(i);\n                        if (c === DQ || c === BS || c === DS) {\n                            out += c;\n                        } else {\n                            out += BS + c;\n                        }\n                    }\n                    else if (c === DS) {\n                        out += parseEnvVar();\n                    }\n                    else {\n                        out += c;\n                    }\n                }\n            }\n            else if (c === DQ || c === SQ) {\n                quote = c;\n            }\n            else if (RegExp('^' + CONTROL + '$').test(c)) {\n                return { op: s };\n            }\n            else if (RegExp('^#$').test(c)) {\n                commented = true;\n                if (out.length){\n                    return [out, { comment: s.slice(i+1) + match.slice(j+1).join(' ') }];\n                }\n                return [{ comment: s.slice(i+1) + match.slice(j+1).join(' ') }];\n            }\n            else if (c === BS) {\n                esc = true;\n            }\n            else if (c === DS) {\n                out += parseEnvVar();\n            }\n            else out += c;\n        }\n\n        if (isGlob) return {op: 'glob', pattern: out};\n\n        return out;\n\n        function parseEnvVar() {\n            i += 1;\n            var varend, varname;\n            //debugger\n            if (s.charAt(i) === '{') {\n                i += 1;\n                if (s.charAt(i) === '}') {\n                    throw new Error(\"Bad substitution: \" + s.substr(i - 2, 3));\n                }\n                varend = s.indexOf('}', i);\n                if (varend < 0) {\n                    throw new Error(\"Bad substitution: \" + s.substr(i));\n                }\n                varname = s.substr(i, varend - i);\n                i = varend;\n            }\n            else if (/[*@#?$!_\\-]/.test(s.charAt(i))) {\n                varname = s.charAt(i);\n                i += 1;\n            }\n            else {\n                varend = s.substr(i).match(/[^\\w\\d_]/);\n                if (!varend) {\n                    varname = s.substr(i);\n                    i = s.length;\n                } else {\n                    varname = s.substr(i, varend.index);\n                    i += varend.index - 1;\n                }\n            }\n            return getVar(null, '', varname);\n        }\n    })\n    // finalize parsed aruments\n    .reduce(function(prev, arg){\n        if (arg === undefined){\n            return prev;\n        }\n        return prev.concat(arg);\n    },[]);\n\n    function getVar (_, pre, key) {\n        var r = typeof env === 'function' ? env(key) : env[key];\n        if (r === undefined && key != '')\n            r = '';\n        else if (r === undefined)\n            r = '$';\n\n        if (typeof r === 'object') {\n            return pre + TOKEN + JSON.stringify(r) + TOKEN;\n        }\n        else return pre + r;\n    }\n}\n"],"names":["flagSymbol","Symbol","ArgError","Error","constructor","msg","code","super","this","name","Object","setPrototypeOf","prototype","arg","opts","argv","process","slice","permissive","stopAtPositional","result","_","aliases","handlers","key","keys","length","type","isFlag","Array","isArray","fn","value","prev","push","Boolean","i","len","wholeArg","concat","separatedArguments","split","map","a","j","originalArgName","argStr","undefined","argName","match","Number","BigInt","flag","COUNT","v","existingCount","module","exports","DefaultPackageRegistry","version","description","help","colors","spec","String","kernel","globalThis","Kernel","terminal","Terminal","install","url","args","warn","localStorage","getItem","setItem","log","pattern","test","fetch","Math","random","toString","cache","json","pkgJson","pkgName","pkgBrowser","browser","values","pkgModule","main","mainUrl","modules","uninstall","importUMDModule","mod","System","import","console","error","fs","existsSync","mkdirSync","pkgFolder","web3osData","writeFileSync","JSON","stringify","packages","parse","readFileSync","index","indexOf","splice","modInfo","loadModule","web3osInstall","execute","pkg","find","p","RegExp","newPackages","filter","unlinkSync","run","term","context","cliParse","cmd","CONTROL","join","TOKEN","pow","s","env","mapped","chunker","commented","op","BS","escape","quote","esc","out","isGlob","c","charAt","parseEnvVar","comment","varend","varname","pre","r","substr","reduce","acc","xs","x"],"sourceRoot":""}