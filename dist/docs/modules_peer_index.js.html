<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding favicon -->
    

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      Web3os Documentation: modules/peer/index.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-dark.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      
          <a href="index.html"><img class="navbar-logo" src="http://github.com/web3os-org/kernel/raw/master/.github/iconlogo.png" /></a>
          <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Documentation</h2></a></div>
          <div class="navbar-badges">
            <a class="navbar-badge" href="https://web3os.sh" target="_blank">
              <img alt="Launch web3os.sh" src="https://img.shields.io/badge/launch-web3os.sh-blue?style=for-the-badge" style="max-width: 100%;"></a>
            <a class="navbar-badge" href="https://github.com/web3os-org/kernel">
              <img alt="View Source" src="https://img.shields.io/badge/repo-web3os%E2%80%94org%2Fkernel-silver?style=for-the-badge&logo=github" />
            </a>
          </div>
        <div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><div class="accordion collapsed" id="824771" > <h3 class="accordion-heading">Kernel<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="global.html#analyticsEvent">analyticsEvent</a></li><li class="accordion-list" id=""><a href="global.html#autostart">autostart</a></li><li class="accordion-list" id=""><a href="global.html#boot">boot</a></li><li class="accordion-list" id=""><a href="global.html#broadcast">broadcast</a></li><li class="accordion-list" id=""><a href="global.html#builtinModules">builtinModules</a></li><li class="accordion-list" id=""><a href="global.html#colorChars">colorChars</a></li><li class="accordion-list" id=""><a href="global.html#createIcon">createIcon</a></li><li class="accordion-list" id=""><a href="global.html#createSpecialLink">createSpecialLink</a></li><li class="accordion-list" id=""><a href="global.html#defaultPackages">defaultPackages</a></li><li class="accordion-list" id=""><a href="global.html#deleteKey">deleteKey</a></li><li class="accordion-list" id=""><a href="global.html#deleteNamespace">deleteNamespace</a></li><li class="accordion-list" id=""><a href="global.html#dialog">dialog</a></li><li class="accordion-list" id=""><a href="global.html#dump">dump</a></li><li class="accordion-list" id=""><a href="global.html#events">events</a></li><li class="accordion-list" id=""><a href="global.html#execute">execute</a></li><li class="accordion-list" id=""><a href="global.html#executeScript">executeScript</a></li><li class="accordion-list" id=""><a href="global.html#fs">fs</a></li><li class="accordion-list" id=""><a href="global.html#get">get</a></li><li class="accordion-list" id=""><a href="global.html#i18n">i18n</a></li><li class="accordion-list" id=""><a href="global.html#icons">icons</a></li><li class="accordion-list" id=""><a href="global.html#importModuleUrl">importModuleUrl</a></li><li class="accordion-list" id=""><a href="global.html#importUMDModule">importUMDModule</a></li><li class="accordion-list" id=""><a href="global.html#intervals">intervals</a></li><li class="accordion-list" id=""><a href="global.html#keyboard">keyboard</a></li><li class="accordion-list" id=""><a href="global.html#loadLocalStorage">loadLocalStorage</a></li><li class="accordion-list" id=""><a href="global.html#loadModule">loadModule</a></li><li class="accordion-list" id=""><a href="global.html#loadPackages">loadPackages</a></li><li class="accordion-list" id=""><a href="global.html#log">log</a></li><li class="accordion-list" id=""><a href="global.html#modules">modules</a></li><li class="accordion-list" id=""><a href="global.html#notify">notify</a></li><li class="accordion-list" id=""><a href="global.html#printBootIntro">printBootIntro</a></li><li class="accordion-list" id=""><a href="global.html#printSystemInfo">printSystemInfo</a></li><li class="accordion-list" id=""><a href="global.html#registerBuiltinModules">registerBuiltinModules</a></li><li class="accordion-list" id=""><a href="global.html#registerKernelBins">registerKernelBins</a></li><li class="accordion-list" id=""><a href="global.html#restore">restore</a></li><li class="accordion-list" id=""><a href="global.html#set">set</a></li><li class="accordion-list" id=""><a href="global.html#setupFilesystem">setupFilesystem</a></li><li class="accordion-list" id=""><a href="global.html#showSplash">showSplash</a></li><li class="accordion-list" id=""><a href="global.html#snackbar">snackbar</a></li><li class="accordion-list" id=""><a href="global.html#specialLinkHandler">specialLinkHandler</a></li><li class="accordion-list" id=""><a href="global.html#systemNotify">systemNotify</a></li><li class="accordion-list" id=""><a href="global.html#updateLocalStorage">updateLocalStorage</a></li><li class="accordion-list" id=""><a href="global.html#utils">utils</a></li><li class="accordion-list" id=""><a href="global.html#wait">wait</a></li><li class="accordion-list" id=""><a href="global.html#windows">windows</a></li></ul> </div><div class="accordion collapsed" id="8429980" > <h3 class="accordion-heading">Modules<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion collapsed child" id=3581095><div class="accordion-heading child"><a href="module-@web3os-core_3pm.html">@web3os-core/3pm</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-@web3os-core_3pm.html#.install">install</a></li><li data-type='method'><a href="module-@web3os-core_3pm.html#.run">run</a></li><li data-type='method'><a href="module-@web3os-core_3pm.html#.uninstall">uninstall</a></li></ul></li><li class="accordion-list" id=""><a href="module-@web3os-core__loader.html">@web3os-core/_loader</a></li><li class="accordion-list" id=""><a href="module-@web3os-core_account.html">@web3os-core/account</a></li><li class="accordion-list" id=""><a href="module-@web3os-core_peer.html">@web3os-core/peer</a></li></ul> </div><div class="accordion collapsed" id="7300142" > <h3 class="accordion-heading">Classes<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion collapsed child" id=5669576><div class="accordion-heading child"><a href="Web3osTerminal.html">Web3osTerminal</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Web3osTerminal.html#.create">create</a></li><li data-type='method'><a href="Web3osTerminal.html#acceptTabSelection">acceptTabSelection</a></li><li data-type='method'><a href="Web3osTerminal.html#cancelTabSelection">cancelTabSelection</a></li><li data-type='method'><a href="Web3osTerminal.html#interruptHandler">interruptHandler</a></li><li data-type='method'><a href="Web3osTerminal.html#isPrintable">isPrintable</a></li><li data-type='method'><a href="Web3osTerminal.html#keyHandler">keyHandler</a></li><li data-type='method'><a href="Web3osTerminal.html#listen">listen</a></li><li data-type='method'><a href="Web3osTerminal.html#log">log</a></li><li data-type='method'><a href="Web3osTerminal.html#paste">paste</a></li><li data-type='method'><a href="Web3osTerminal.html#prompt">prompt</a></li><li data-type='method'><a href="Web3osTerminal.html#promptCompile">promptCompile</a></li><li data-type='method'><a href="Web3osTerminal.html#run">run</a></li><li data-type='method'><a href="Web3osTerminal.html#tabCompletion">tabCompletion</a></li><li data-type='method'><a href="Web3osTerminal.html#unlisten">unlisten</a></li></ul></li></ul> </div><div class="accordion collapsed" id="9846081" > <h3 class="accordion-heading">Tutorials<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="tutorial-connect-your-wallet.html">Connect your wallet</a></li></ul> </div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        modules/peer/index.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module @web3os-core/peer
 * @author Jay Mathis &lt;code@mathis.network>
 * @license MIT
 * @see https://peerjs.com
 * @see https://github.com/web3os-org/kernel
 * 
 * @todo Fix receiving emojis causing BinaryPackFailure
 * 
 * @description
 * PeerJS Utility
 * 
 * &lt;pre>
 * 
 * 
 * 
    Usage:
      peer &lt;command> &lt;args> [options]

    To set your ID (default is UUID):
      peer id --id myfirstdevice

    Default Connection Broker:
      Kernel.get('peerjs', 'server-host') if set, or 0.peerjs.com

    Commands:
      call &lt;peer-id> [--video] [--audio]                                     Call a peer with media streams
      chat &lt;peer-id>                                                         Open a text chat with a peer
      connect &lt;peer-id>                                                      Connect to a peer
      id                                                                     Display your peer ID
      list                                                                   List available peers
      send &lt;peer-id> [--text] [--text-file] [--json] [--json-file]           Send a raw message
      screen &lt;peer-id>                                                       Share your screen with a peer
      upload &lt;peer-id> [--file]                                              Upload a file to a peer

    Options:
      --debug                                                                Debug level ({0},1,2,3)
      --file                                                                 Path of the file to upload
      --help                                                                 Print this help message
      --id                                                                   Set your peer ID
      --json                                                                 JSON string to send
      --json-file                                                            Path to JSON file to send
      --server-host                                                          Set the peerjs broker host
      --server-key                                                           Server API key (for 0.peerjs.com)
      --server-path                                                          Set the peerjs broker path {/}
      --server-port                                                          Set the peerjs broker port {443}
      --text                                                                 Text message to send
      --text-file                                                            Path to the text file to send
      --version                                                              Print the version information
 * &lt;/pre>
 */

import arg from 'arg'
import Peer from 'peerjs/dist/peerjs.esm'
import colors from 'ansi-colors'
import { parse as cliParse } from 'shell-quote'

import styles from './peer.module.css'

export const name = 'peer'
export const version = '0.1.0'
export const description = 'PeerJS Utility'
export const help = `
  ${colors.magenta.bold('PeerJS Utility')}

  Usage:
    peer &lt;command> &lt;args> [options]

  To set your ID (default is UUID):
    peer id --id myfirstdevice

  Default Connection Broker:
    ${colors.bold("Kernel.get('peerjs', 'server-host')")} if set, or ${colors.bold('0.peerjs.com')}

  Commands:
    call &lt;peer-id> [--video] [--audio]                                     Call a peer with media streams
    chat &lt;peer-id>                                                         Open a text chat with a peer
    connect &lt;peer-id>                                                      Connect to a peer
    id                                                                     Display your peer ID
    list                                                                   List available peers
    send &lt;peer-id> [--text] [--text-file] [--json] [--json-file]           Send a raw message
    screen &lt;peer-id>                                                       Share your screen with a peer
    upload &lt;peer-id> [--file]                                              Upload a file to a peer

  Options:
    --debug                                                                Debug level ({0},1,2,3)
    --file                                                                 Path of the file to upload
    --help                                                                 Print this help message
    --id                                                                   Set your peer ID
    --json                                                                 JSON string to send
    --json-file                                                            Path to JSON file to send
    --server-host                                                          Set the peerjs broker host
    --server-key                                                           Server API key (for 0.peerjs.com)
    --server-path                                                          Set the peerjs broker path {/}
    --server-port                                                          Set the peerjs broker port {443}
    --text                                                                 Text message to send
    --text-file                                                            Path to the text file to send
    --version                                                              Print the version information
`

export const spec = {
  '--audio': Boolean,
  '--debug': Number,
  '--file': String,
  '--id': String,
  '--help': Boolean,
  '--json': String,
  '--json-file': String,
  '--server-key': String,
  '--server-host': String,
  '--server-port': Number,
  '--server-path': String,
  '--server-secure': Boolean,
  '--server-ping-interval': Number,
  '--text': String,
  '--text-file': String,
  '--version': Boolean,
  '--video': Boolean
}

let kernel = globalThis.Kernel
let terminal
const { t } = kernel.i18n

export let id = ''
export let instance
export const connections = {}

export function setupInstance () {
  return new Promise((resolve, reject) => {
    instance.on('open', myId => { id = myId; resolve(id) })
    instance.on('error', err => { console.error(err); reject(err) })
    instance.on('connection', connection => {
      connection.on('open', () => {
        console.log('Incoming connection from', connection.peer)
        kernel.execute(`snackbar Incoming connection from ${connection.peer}`)
        connections[connection.peer] = { connection }
        connection.on('data', data => processIncomingData(data, connection))
      })
    })

    instance.on('call', async call => {
      let avState = ''
      if (call.metadata.video &amp;&amp; call.metadata.audio) avState = 'Audio &amp; Video'
      if (call.metadata.video &amp;&amp; !call.metadata.audio) avState = 'Video Only'
      if (!call.metadata.video &amp;&amp; call.metadata.audio) avState = 'Audio Only'
      if (call.metadata.screen) avState = 'Screenshare'

      const container = document.createElement('div')
      container.innerHTML = `
        &lt;p>
          You have an incoming call (${avState}) from:
          &lt;br />
          &lt;strong style='font-family: monospace'>${call.peer}&lt;/strong>
        &lt;/p>
      `
    
      const result = await kernel.dialog({
        icon: 'info',
        title: `Incoming ${call.metadata.screen ? 'Screenshare' : 'Call'}`,
        html: container.outerHTML,
        reverseButtons: true,
        showDenyButton: true,
        denyButtonText: 'Decline',
        confirmButtonText: call.metadata.screen ? 'Accept' : 'Answer'
      })

      if (result.isConfirmed) {
        if (call.metadata.screen) {
          call.answer()
        } else {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: call.metadata?.audio, video: call.metadata?.video })
          call.answer(stream)
        }

        call.on('stream', peerStream => {
          const video = document.createElement('video')
          video.style.width = '100%'
          video.style.height = '100%'

          if ('srcObject' in video) {
            video.srcObject = peerStream
          } else {
            video.src = URL.createObjectURL(peerStream)
          }

          video.onloadedmetadata = () => video.play()

          const title = call.metadata.screen ? t('Screen') : `${t('Call')} ${call.metadata.audio ? `(${t('Audio')})` : ''}${call.metadata.video ? `(${t('Video')})` : ''}`

          kernel.windows.create({
            title: `${title}: ${call.peer}`,
            mount: video,
            max: true,
            onclose: () => {

              call.close()
            }
          })
        })

        call.on('close', () => {
          console.log('call closed')
        })
      }
    })
  })
}

async function processIncomingData (data, connection) {
  console.debug({ data, connection })
  if (typeof data === 'object' &amp;&amp; data.cmd) {
    let result
    switch (data.cmd) {
      case 'chat':
        result = await kernel.dialog({
          title: 'Incoming Chat',
          html: `&lt;p>Peer ID:&lt;br />${connection.peer}&lt;/p>&lt;h3>Accept?&lt;/h3>`,
          showDenyButton: true,
          confirmButtonText: 'Yes'
        })

        if (result.isConfirmed) openChatWindow(connections[connection.peer])
        break
      case 'upload':
        result = await kernel.dialog({
          title: t('Incoming Upload'),
          html: `&lt;p>${t('Peer ID')}:&lt;br />${connection.peer}&lt;/p>&lt;p>${t('Filename')}:&lt;br />${data.filename}&lt;/p>`,
          inputLabel: t('Where would you like to save this file?'),
          inputValue: kernel.get('peer', 'defaultReceivePath') || '/tmp',
          reverseButtons: true,
          showDenyButton: true,
          denyButtonText: t('Cancel'),
          confirmButtonText: t('Save'),
          input: 'text'
        })

        if (result.isConfirmed) return kernel.fs.writeFileSync(data.filename, data.content)
        break
      default:
        throw new Error(`Invalid command ${JSON.stringify(data)} received from peer ${connection.peer}`)
    }
  }
}

export function connect (peerId, args) {
  return new Promise((resolve, reject) => {
    if (!peerId || peerId === '') return reject(new Error('Invalid peer'))
    connections[peerId] = { connection: instance.connect(peerId) }
    connections[peerId].connection.on('open', () => resolve(peerId))
    connections[peerId].connection.on('error', err => {
      console.error(err)
      reject(err)
    })
  })
}

export async function call (peerId, args) {
  const peer = connections[peerId]
  if (!peer) throw new Error('Not connected to that peer')
  if (!navigator.mediaDevices) throw new Error('Media devices not available')

  const metadata =
    args.screen
    ? { screen: true }
    : { audio: args['--audio'], video: args['--video'] }

  const stream = args.screen ? await navigator.mediaDevices.getDisplayMedia() : await navigator.mediaDevices.getUserMedia(metadata)
  const call = instance.call(peerId, stream, { metadata })

  call.on('stream', peerStream => {
    const video = document.createElement('video')
    video.style.width = '100%'
    video.style.height = '100%'

    if ('srcObject' in video) {
      video.srcObject = peerStream
    } else {
      video.src = URL.createObjectURL(peerStream)
    }

    video.onloadedmetadata = () => video.play()

    const title = metadata.screen ? t('Screen') : `${t('Call')} ${metadata.audio ? `(${t('Audio')})` : ''}${metadata.video ? `(${t('Video')})` : ''}`

    kernel.windows.create({
      title: `${title}: ${call.peer}`,
      mount: video,
      max: true,
      onclose: () => {
        call.close()
      }
    })
  })

  call.on('close', () => {
    console.log('call closed')
  })
}

export function openChatWindow (peer) {
  const container = document.createElement('div')
  container.classList.add(styles.container)
  const chat = document.createElement('div')
  chat.classList.add(styles.chat)
  const form = document.createElement('form')
  form.classList.add(styles.form)
  const input = document.createElement('input')
  input.classList.add(styles.input)
  const button = document.createElement('button')
  button.classList.add(styles.button)
  button.type = 'submit'
  button.textContent = 'Send'

  container.appendChild(chat)
  form.appendChild(input)
  form.appendChild(button)
  container.appendChild(form)

  const receiveMessage = data => {
    if (typeof data !== 'string') return
    const bubble = document.createElement('div')
    bubble.classList.add(styles.bubble, styles.toMe)
    bubble.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2)
    chat.appendChild(bubble)
    bubble.scrollIntoView()
  }

  const sendMessage = data => {
    if (!data || data === '') return
    const bubble = document.createElement('div')
    bubble.classList.add(styles.fromMe)
    bubble.textContent = data
    chat.appendChild(bubble)
    bubble.scrollIntoView()
    peer.connection.send(data)
  }

  peer.connection.on('data', receiveMessage)
  peer.connection.send({ cmd: 'chat' })

  form.addEventListener('submit', e => {
    e.preventDefault()
    sendMessage(input.value)
    input.value = ''
  })

  kernel.windows.create({
    title: `Chat: ${peer.connection.peer}`,
    mount: container,
    width: '100%',
    max: false,
    onclose: () => {
      peer.connection.off('data', receiveMessage)
    }
  })
}

export async function chat (peerId) {
  const peer = connections[peerId]
  if (!peer) throw new Error('Not connected to that peer')
  openChatWindow(peer)
}

export async function screen (peerId) {
  const peer = connections[peerId]
  if (!peer) throw new Error('Not connected to that peer')
  if (!navigator.mediaDevices) throw new Error('Media devices not available')
  call(peerId, { screen: true })
}

export async function send (peerId, args) {
  const peer = connections[peerId]
  if (!peer) throw new Error('Not connected to that peer')
  if (args['--text']) return peer.connection.send(args['--text'])
  if (args['--text-file']) return peer.connection.send(kernel.fs.readFileSync(args['--text-file']).toString())
  if (args['--json']) return peer.connection.send(JSON.parse(args['--json']))
  if (args['--json-file']) return peer.connection.send(JSON.parse(kernel.fs.readFileSync(args['--json-file']).toString()))
}

export async function upload (peerId, args) {
  const peer = connections[peerId]
  if (!peer) throw new Error('Not connected to that peer')
  const content = kernel.fs.readFileSync(args['--file'])
  peer.connection.send({ cmd: 'upload', filename: kernel.utils.path.parse(args['--file']).base, content })
}

export async function run (term, context = '') {
  const args = arg(spec, { argv: cliParse(context) })
  if (args['--version']) return term.log(version)
  if (args['--help']) return term.log(help)

  const cmd = args._?.[0]

  terminal = term
  kernel = term.kernel

  const peerOptions = {}

  if (args['--debug']) peerOptions.debug = args['--debug']
  if (args['--server-key']) peerOptions.key = args['--server-key']
  if (args['--server-host']) peerOptions.host = args['--server-host']
  if (args['--server-port']) peerOptions.port = args['--server-port']
  if (args['--server-path']) peerOptions.path = args['--server-path']
  if (args['--server-secure']) peerOptions.secure = args['--server-secure']
  if (args['--server-ping-interval']) peerOptions.pingInterval = args['--server-ping-interval']

  if (!args['--server-host'] &amp;&amp; kernel.get('peerjs', 'server-host')) {
    peerOptions.host = kernel.get('peerjs', 'server-host')
  }

  if (args['--id'] &amp;&amp; id !== args['--id']) {
    instance = new Peer(args?.['--id'], peerOptions)
    await setupInstance()
  }

  if (!instance) {
    instance = new Peer(peerOptions)
    await setupInstance()
  }

  switch (cmd) {
    case 'call':
      return await call(args._?.[1], args)
    case 'chat':
      return await chat(args._?.[1], args)
    case 'connect':
      return await connect(args._?.[1], args)
    case 'id':
      return term.log(id)
    case 'list':
      return term.log(Object.keys(connections))
    case 'screen':
      return await screen(args._?.[1], args)
    case 'send':
      return await send(args._?.[1], args)
    case 'upload':
      return await upload(args._?.[1], args)
    default:
      return term.log(help)
  }
}
</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    <script src="scripts/fix-readme-anchors.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"@web3os-core/3pm","link":"<a href=\"module-@web3os-core_3pm.html\">@web3os-core/3pm</a>"},{"title":"module:@web3os-core/3pm.install","link":"<a href=\"module-@web3os-core_3pm.html#.install\">module:@web3os-core/3pm &rtrif; install</a>"},{"title":"module:@web3os-core/3pm.run","link":"<a href=\"module-@web3os-core_3pm.html#.run\">module:@web3os-core/3pm &rtrif; run</a>"},{"title":"module:@web3os-core/3pm.uninstall","link":"<a href=\"module-@web3os-core_3pm.html#.uninstall\">module:@web3os-core/3pm &rtrif; uninstall</a>"},{"title":"@web3os-core/_loader","link":"<a href=\"module-@web3os-core__loader.html\">@web3os-core/_loader</a>"},{"title":"@web3os-core/account","link":"<a href=\"module-@web3os-core_account.html\">@web3os-core/account</a>"},{"title":"@web3os-core/peer","link":"<a href=\"module-@web3os-core_peer.html\">@web3os-core/peer</a>"},{"title":"Web3osTerminal","link":"<a href=\"Web3osTerminal.html\">Web3osTerminal</a>"},{"title":"Web3osTerminal.create","link":"<a href=\"Web3osTerminal.html#.create\">Web3osTerminal &rtrif; create</a>"},{"title":"Web3osTerminal#acceptTabSelection","link":"<a href=\"Web3osTerminal.html#acceptTabSelection\">Web3osTerminal &rtrif; acceptTabSelection</a>"},{"title":"Web3osTerminal#cancelTabSelection","link":"<a href=\"Web3osTerminal.html#cancelTabSelection\">Web3osTerminal &rtrif; cancelTabSelection</a>"},{"title":"Web3osTerminal#interruptHandler","link":"<a href=\"Web3osTerminal.html#interruptHandler\">Web3osTerminal &rtrif; interruptHandler</a>"},{"title":"Web3osTerminal#isPrintable","link":"<a href=\"Web3osTerminal.html#isPrintable\">Web3osTerminal &rtrif; isPrintable</a>"},{"title":"Web3osTerminal#keyHandler","link":"<a href=\"Web3osTerminal.html#keyHandler\">Web3osTerminal &rtrif; keyHandler</a>"},{"title":"Web3osTerminal#listen","link":"<a href=\"Web3osTerminal.html#listen\">Web3osTerminal &rtrif; listen</a>"},{"title":"Web3osTerminal#log","link":"<a href=\"Web3osTerminal.html#log\">Web3osTerminal &rtrif; log</a>"},{"title":"Web3osTerminal#paste","link":"<a href=\"Web3osTerminal.html#paste\">Web3osTerminal &rtrif; paste</a>"},{"title":"Web3osTerminal#prompt","link":"<a href=\"Web3osTerminal.html#prompt\">Web3osTerminal &rtrif; prompt</a>"},{"title":"Web3osTerminal#promptCompile","link":"<a href=\"Web3osTerminal.html#promptCompile\">Web3osTerminal &rtrif; promptCompile</a>"},{"title":"Web3osTerminal#run","link":"<a href=\"Web3osTerminal.html#run\">Web3osTerminal &rtrif; run</a>"},{"title":"Web3osTerminal#tabCompletion","link":"<a href=\"Web3osTerminal.html#tabCompletion\">Web3osTerminal &rtrif; tabCompletion</a>"},{"title":"Web3osTerminal#unlisten","link":"<a href=\"Web3osTerminal.html#unlisten\">Web3osTerminal &rtrif; unlisten</a>"},{"title":"connect-your-wallet","link":"connect-your-wallet"},{"title":"analyticsEvent","link":"<a href=\"global.html#analyticsEvent\">analyticsEvent</a>"},{"title":"autostart","link":"<a href=\"global.html#autostart\">autostart</a>"},{"title":"boot","link":"<a href=\"global.html#boot\">boot</a>"},{"title":"broadcast","link":"<a href=\"global.html#broadcast\">broadcast</a>"},{"title":"builtinModules","link":"<a href=\"global.html#builtinModules\">builtinModules</a>"},{"title":"colorChars","link":"<a href=\"global.html#colorChars\">colorChars</a>"},{"title":"createIcon","link":"<a href=\"global.html#createIcon\">createIcon</a>"},{"title":"createSpecialLink","link":"<a href=\"global.html#createSpecialLink\">createSpecialLink</a>"},{"title":"defaultPackages","link":"<a href=\"global.html#defaultPackages\">defaultPackages</a>"},{"title":"deleteKey","link":"<a href=\"global.html#deleteKey\">deleteKey</a>"},{"title":"deleteNamespace","link":"<a href=\"global.html#deleteNamespace\">deleteNamespace</a>"},{"title":"dialog","link":"<a href=\"global.html#dialog\">dialog</a>"},{"title":"dump","link":"<a href=\"global.html#dump\">dump</a>"},{"title":"events","link":"<a href=\"global.html#events\">events</a>"},{"title":"execute","link":"<a href=\"global.html#execute\">execute</a>"},{"title":"executeScript","link":"<a href=\"global.html#executeScript\">executeScript</a>"},{"title":"fs","link":"<a href=\"global.html#fs\">fs</a>"},{"title":"get","link":"<a href=\"global.html#get\">get</a>"},{"title":"i18n","link":"<a href=\"global.html#i18n\">i18n</a>"},{"title":"icons","link":"<a href=\"global.html#icons\">icons</a>"},{"title":"importModuleUrl","link":"<a href=\"global.html#importModuleUrl\">importModuleUrl</a>"},{"title":"importUMDModule","link":"<a href=\"global.html#importUMDModule\">importUMDModule</a>"},{"title":"intervals","link":"<a href=\"global.html#intervals\">intervals</a>"},{"title":"keyboard","link":"<a href=\"global.html#keyboard\">keyboard</a>"},{"title":"loadLocalStorage","link":"<a href=\"global.html#loadLocalStorage\">loadLocalStorage</a>"},{"title":"loadModule","link":"<a href=\"global.html#loadModule\">loadModule</a>"},{"title":"loadPackages","link":"<a href=\"global.html#loadPackages\">loadPackages</a>"},{"title":"log","link":"<a href=\"global.html#log\">log</a>"},{"title":"modules","link":"<a href=\"global.html#modules\">modules</a>"},{"title":"notify","link":"<a href=\"global.html#notify\">notify</a>"},{"title":"printBootIntro","link":"<a href=\"global.html#printBootIntro\">printBootIntro</a>"},{"title":"printSystemInfo","link":"<a href=\"global.html#printSystemInfo\">printSystemInfo</a>"},{"title":"registerBuiltinModules","link":"<a href=\"global.html#registerBuiltinModules\">registerBuiltinModules</a>"},{"title":"registerKernelBins","link":"<a href=\"global.html#registerKernelBins\">registerKernelBins</a>"},{"title":"restore","link":"<a href=\"global.html#restore\">restore</a>"},{"title":"set","link":"<a href=\"global.html#set\">set</a>"},{"title":"setupFilesystem","link":"<a href=\"global.html#setupFilesystem\">setupFilesystem</a>"},{"title":"showSplash","link":"<a href=\"global.html#showSplash\">showSplash</a>"},{"title":"snackbar","link":"<a href=\"global.html#snackbar\">snackbar</a>"},{"title":"specialLinkHandler","link":"<a href=\"global.html#specialLinkHandler\">specialLinkHandler</a>"},{"title":"systemNotify","link":"<a href=\"global.html#systemNotify\">systemNotify</a>"},{"title":"updateLocalStorage","link":"<a href=\"global.html#updateLocalStorage\">updateLocalStorage</a>"},{"title":"utils","link":"<a href=\"global.html#utils\">utils</a>"},{"title":"wait","link":"<a href=\"global.html#wait\">wait</a>"},{"title":"windows","link":"<a href=\"global.html#windows\">windows</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    

    

    


  </body>

</html>
