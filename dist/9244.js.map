{"version":3,"file":"9244.js","mappings":"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","sources":["file:////home/j/code/web3os/@web3os-core/kernel/src/modules/three/index.js"],"sourcesContent":["import arg from 'arg'\nimport colors from 'ansi-colors'\nimport { parse as cliParse } from 'shell-quote'\n\nimport 'animate.css'\nimport classes from './three.module.css'\nimport { speak } from '../speak'\n\nexport const name = 'three'\nexport const version = '0.2.0'\nexport const description = 'Three: The open source assistant for web3os'\nexport const help = `\n  Usage:\n    three                             Start Three\n    three <command> [options]         Run a Three command\n\n  Commands:\n    exit                              Close Three\n    move <x> <y>                      Move to specified coordinates; e.g. move 50% 50px\n    say <text>                        Say the specified text\n\n  Options:\n    --help                            Print this help message\n    --version                         Print the version information\n`\n\nexport const spec = {\n  '--help': Boolean,\n  '--version': Boolean,\n  '-h': '--help',\n  '-v': '--version'\n}\n\nlet kernel = globalThis.Kernel\nlet terminal = globalThis.Terminal\n\nexport let isAmorphous = true\n\nfunction random (min, max) {\n  return Math.floor(Math.random() * (max - min) + min)\n}\n\nexport function getInstance () {\n  return document.querySelector('#web3os-three-orb')\n}\n\nexport function exit () {\n  console.log('Three is leaving')\n  kernel.execute('speak --reset')\n  say('Goodbye!')\n  document.querySelector('#web3os-three-orb').remove()\n}\n\nexport function move (x, y) {\n  const orb = getInstance()\n  if (x) orb.style.left = x\n  if (y) orb.style.top = y\n}\n\nexport function animate (...styles) {\n  const orb = getInstance()\n\n  for (const cls of Array.from(orb.classList)) {\n    if (cls !== 'animate__animated' && /^animate__/.test(cls)) {\n      orb.classList.remove(cls)\n    }\n  }\n\n  for (const style of styles) {\n    setTimeout(() => orb.classList.add(`animate__${style}`), 0)\n  }\n}\n\nexport function setProperty (name, value) {\n  document.documentElement.style.setProperty(name, value)\n}\n\nexport async function angry (delay = 1000) {\n  const orb = getInstance()\n\n  const properties = {\n    '--three-glow-inner': { new: '#eb4034' },\n    '--three-glow-outer': { new: 'red' },\n    '--three-glow-outer-left': { new: 'red' },\n    '--three-glow-outer-right': { new: 'red' }\n  }\n\n  for (const prop of Object.keys(properties)) {\n    properties[prop].old = getComputedStyle(document.documentElement).getPropertyValue(prop)\n    setProperty(prop, properties[prop].new)\n  }\n\n  orb.style.color = 'white'\n  orb.textContent = '!'\n  animate('headShake')\n\n  // Now calm down\n  await Kernel.wait(delay)\n\n  for (const prop of Object.keys(properties)) {\n    setProperty(prop, properties[prop].old)\n  }\n\n  orb.style.color = 'rgba(0, 0, 0, 0.05)'\n  orb.textContent = '3'\n}\n\nexport function amorphous (enabled = true, delay = 50) {\n  const orb = getInstance()\n  clearInterval(orb.amorphousInterval)\n\n  orb.style.borderTopLeftRadius = `50%`\n  orb.style.borderTopRightRadius = `50%`\n  orb.style.borderBottomLeftRadius = `50%`\n  orb.style.borderBottomRightRadius = `50%`\n\n  orb.amorphousInterval = enabled ? setInterval(() => {\n    orb.style.borderTopLeftRadius = `${random(15, 80)}%`\n    orb.style.borderTopRightRadius = `${random(15, 80)}%`\n    orb.style.borderBottomLeftRadius = `${random(15, 80)}%`\n    orb.style.borderBottomRightRadius = `${random(15, 80)}%`\n  }, delay) : null\n}\n\nexport async function createInstance () {\n  const orb = document.createElement('figure')\n\n  orb.id = 'web3os-three-orb'\n  orb.textContent = '3'\n  orb.draggable = true\n  orb.classList.add(classes.orb, 'animate__animated')\n\n  document.body.appendChild(orb)\n\n  const dragStart = e => {\n    let dragImage = document.createElement('div');\n    dragImage.style.opacity = 0\n    orb.style.transition = 'unset'\n    e.dataTransfer?.setDragImage(dragImage, 0, 0)\n    e.dataTransfer?.setData('text', 'three.orb')\n  }\n\n  const drag = e => {\n    const coordinates = { x: null, y: null }\n    coordinates.x = e.type === 'touchmove' ? e.changedTouches[0].pageX : e.clientX\n    coordinates.y = e.type === 'touchmove' ? e.changedTouches[0].pageY : e.clientY\n    if (coordinates.x === 0 && coordinates.y === 0) return\n    move(`${coordinates.x - 25}px`, `${coordinates.y - 25}px`)\n  }\n\n  const dragEnd = e => {\n    const { getUtterance, speak, voices } = Kernel.modules.speak\n\n    orb.style.transition = ''\n    const coordinates = { x: null, y: null }\n    coordinates.x = e.type === 'touchend' ? e.changedTouches[0].pageX : e.clientX\n    coordinates.y = e.type === 'touchend' ? e.changedTouches[0].pageY : e.clientY\n    if (coordinates.x === 0 && coordinates.y === 0) return\n    move(`${coordinates.x - 25}px`, `${coordinates.y - 25}px`)\n    amorphous(true, 50)\n    angry()\n\n    if (\n      coordinates.x >= window.innerWidth - 25\n      || coordinates.y >= window.innerHeight - 25\n      || coordinates.x <= 0\n      || coordinates.y <= 0\n    ) {\n      exit()\n    }\n  }\n\n  orb.ondragstart = dragStart\n  orb.addEventListener('touchstart', dragStart)\n  orb.ondragend = dragEnd\n  orb.addEventListener('touchend', dragEnd)\n  orb.ondrag = drag\n  orb.addEventListener('touchmove', drag)\n\n  orb.addEventListener('dblclick', () => {\n    const hiding = orb.style.opacity === '' || orb.style.opacity === '1'\n\n    if (hiding) orb.style.opacity = 0.3\n    else orb.style.opacity = 1\n\n    if (hiding) orb.style.backgroundColor = 'rgba(0, 200, 0, 0.3)'\n    else orb.style.backgroundColor = 'inherit'\n\n    if (hiding) orb.style.boxShadow = 'none'\n    else orb.style.boxShadow = ''\n  })\n\n  amorphous(true)\n  animate('zoomInUp')\n\n  for await (const each of Array.from(Array(15).keys())) {\n    move(random(10, 80) + '%', random(10, 80) + '%')\n    await Kernel.wait(random(50, 100))\n  }\n\n  move('85%', '5%')\n\n  return orb\n}\n\nexport async function say (text) {\n  if (kernel.get('three', 'disable-voice')) return\n  let { getUtterance, speak, voices } = Kernel.modules.speak\n  if (voices?.length === 0) voices = speechSynthesis.getVoices()\n\n  const selectedVoice = Kernel.get('three', 'voice') || 'Google US English'\n  const volume = parseFloat(Kernel.get('three', 'volume') || 2)\n  const pitch = parseFloat(Kernel.get('three', 'pitch') || 0.2)\n  const rate = parseFloat(Kernel.get('three', 'rate') || 1)\n  const voice = voices.find(v => v.name.toLowerCase() === selectedVoice.toLowerCase())\n\n  speak(getUtterance(text, voice, volume, pitch, rate))\n}\n\nexport async function run (term, context) {\n  let orb\n  const args = arg(spec, { argv: cliParse(context) })\n  if (args['--version']) return term.log(version)\n  if (args['--help']) return term.log(help)\n\n  const cmd = args._?.[0]\n  terminal = args.terminal = term\n  kernel = args.kernel = term.kernel\n\n  if (!getInstance()) {\n    orb = await createInstance()\n    say(\"Welcome to web3 OS. I'm Three, and I'll be your guide.\")\n    say(\"There's lots to explore, so let's get started!\")\n    say(\"Just double tap me and I'll try to stay out of your way\")\n    say(\"Or you may also drag me to any edge and I'll go away\")\n  } else {\n    orb = getInstance()\n    orb.style.opacity = 1\n    orb.style.backgroundColor = 'inherit'\n    orb.style.boxShadow = ''\n  }\n\n  switch (cmd) {\n    case 'exit':\n      return exit()\n    case 'move':\n      return move(args._?.[1], args._?.[2])\n    case 'say':\n      return await say(args._?.[1])\n    case undefined:\n      return\n    default:\n      return term.log(help)\n  }\n}\n"],"names":["i","name","version","description","help","spec","Boolean","kernel","globalThis","Kernel","isAmorphous","Terminal","random","min","max","Math","floor","getInstance","document","querySelector","exit","console","log","execute","say","remove","move","x","y","orb","style","left","top","animate","Array","from","classList","cls","test","styles","setTimeout","add","setProperty","value","documentElement","angry","delay","properties","new","Object","keys","prop","old","getComputedStyle","getPropertyValue","color","textContent","wait","amorphous","enabled","clearInterval","amorphousInterval","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","setInterval","createInstance","createElement","id","draggable","classes","body","appendChild","dragStart","e","dragImage","opacity","transition","dataTransfer","setDragImage","setData","drag","coordinates","type","changedTouches","pageX","clientX","pageY","clientY","dragEnd","modules","speak","getUtterance","voices","window","innerWidth","innerHeight","ondragstart","addEventListener","ondragend","ondrag","hiding","backgroundColor","boxShadow","text","get","length","speechSynthesis","getVoices","selectedVoice","volume","parseFloat","pitch","rate","voice","find","v","toLowerCase","run","term","context","args","arg","argv","cliParse","cmd","_","terminal","undefined"],"sourceRoot":""}